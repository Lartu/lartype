<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, height=device-height, user-scalable=no" />
		<style>
	body{
		font-family:Times New Roman;
		font-size:15px;
		text-align:justify;
		padding:20px;
		padding-top:60px;
		padding-bottom:60px;
		background:white;
		color:black;
		max-width:595px; /*Ancho A4 en 72dpi*/
		margin-left:auto;
		margin-right:auto;
	}

	p{
		padding:0px;
		margin:0px;
		margin-top:10px;
		margin-bottom:10px;
	}

	div{
		page-break-inside: avoid !important;
	}

	@media print {
		.pagebreak {
			page-break-before: always !important;
		}
		body{
			max-width:100%;
		}
	}

	pre{
		white-space: pre-wrap;
	}

	.codeSection{
		page-break-inside: avoid !important;
		display:block;
		text-align:left;
		padding:5px;
		background: #dadeea;
		color: #192a56;
		margin-top:20px;
		margin-bottom:20px;
	}

	td .codeSection{
		page-break-inside: initial !important;
	}

	.imagen{
		page-break-inside: avoid !important;
		display:block;
		max-width: 595px; /*100%, basado en el ancho hardcodeado de la página*/
		text-align:left;
		margin:auto;
		margin-top:20px;
		margin-bottom:20px;
	}

	.imagen2{
		page-break-inside: avoid !important;
		display:block;
		max-width: 357px; /*60%, basado en el ancho hardcodeado de la página*/
		text-align:left;
		margin:auto;
		margin-top:20px;
		margin-bottom:20px;
	}

	.imagen3{
		page-break-inside: avoid !important;
		display:block;
		max-width: 178px; /*30%, basado en el ancho hardcodeado de la página*/
		text-align:left;
		margin:auto;
		margin-top:20px;
		margin-bottom:20px;
	}

	.imagen4{
		display:inline-block;
		max-height:1.5em;
		width:auto;
		vertical-align:middle;
	}
	
	.codeTitle{
		font-size:16px;
		font-weight:bold;
		margin-bottom: 8px;
		padding:0px;
		color:black;
	}

	.titleArea{
		margin-top:80px;
		margin-bottom:80px;
		text-align:center;
	}

	.title{
		margin-top:5px;
		margin-bottom:5px;
		font-size:26px;
	}

	.subtitle{
		margin-top:5px;
		margin-bottom:5px;
		font-size:20px;
	}

	.sectionTitle{
		page-break-inside: avoid !important;
		margin-top:45px;
		margin-bottom:0px;
		font-size:17px;
	}

	hr{
		border-bottom:1px solid black;
		margin-top:10px;
		margin-bottom:10px;
	}

	code{
		display:inline-block;
		font-family:monospace;
		font-size:12px;
		color: #d63031;
		background:#ffe5e9;
	}

	a{
		color:#0984e3;
		text-decoration:underline;
	}

	.imageFooter{
		margin-top:-15px;
		font-size:0.8em;
		text-align:center;
		margin-bottom:20px;
	}

	table{
		page-break-inside: avoid !important;
		width: 100%;
	}

	td{
		width: 50%;
		vertical-align:top;
		text-align: justify;
	}

	</style>
	</head>
	
	<body>

	<span id="texto"></span>

	<script type="text/javascript">

		var files_to_load=[]

		String.prototype.replaceAll = function(searchStr, replaceStr) {
			var str = this;
			while(str.indexOf(searchStr) != -1) {
				str = str.replace(searchStr, replaceStr);
			}
			return str;
		}

		var num = 0;
		var inner_text = "";
	
		window.onload = traerListaArchivos();

		function traerListaArchivos() {
			//Cargo el texto
			var request = new XMLHttpRequest();

			request.open('GET', '../lartype_sources.cfg', true);
			console.log("Loading sources list.");

			request.onload = function() {
				if (request.status >= 200 && request.status < 400) {
					console.log("List found.");
					var resp = request.responseText;
					files_to_load = resp.split("\n");
					for(a = 0; a < files_to_load.length; a++){
						files_to_load[a] = files_to_load[a].trim();
					}	
					traerTexto();
				}
			};

			request.send();
		}

		function traerTexto() {
			if(num >= files_to_load.length-1){
				console.log("Rendering...");
				reemplazar(inner_text);
				return;
			}

			if(files_to_load[num].length == 0){
				num++;
				traerTexto();
			}

			//Cargo el texto
			var request = new XMLHttpRequest();

			request.open('GET', '../sources/'+files_to_load[num]+'.lty', true);
			console.log("Loading sources/" + files_to_load[num] +'.lty');

			request.onload = function() {
				if (request.status >= 200 && request.status < 400) {
					console.log("sources/" + files_to_load[num] +'.lty found.');
					var resp = request.responseText;
					inner_text += resp;
					num++;
					traerTexto();
				}
			};

			request.send();
		}
		
		function reemplazar(texto) {

			//Saco los que sean //.
			texto = texto.replaceAll('//.', "&barrita;");

			//Chirimbolos and such
			texto = texto.replaceAll('>', '&gt;');
			texto = texto.replaceAll('<', '&lt;');

			texto = texto.replaceAll('/section.', '<p style="margin-top:10px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;');
			texto = texto.replaceAll('.section/', '</p>');
			texto = texto.replaceAll('/titlearea.', '<div class="titleArea">');
			texto = texto.replaceAll('.titlearea/', '</div>');
			texto = texto.replaceAll('/title.', '<div class="title">');
			texto = texto.replaceAll('.title/', '</div>');
			texto = texto.replaceAll('/subtitle.', '<div class="subtitle">');
			texto = texto.replaceAll('.subtitle/', '</div>');
			texto = texto.replaceAll('/sectiontitle.', '<div class="sectionTitle">');
			texto = texto.replaceAll('.sectiontitle/', '</div>');
			texto = texto.replaceAll('/b.', '<b>');
			texto = texto.replaceAll('.b/', '</b>');
			texto = texto.replaceAll('/i.', '<i>');
			texto = texto.replaceAll('.i/', '</i>');
			texto = texto.replaceAll('/line.', '<hr>');
			texto = texto.replaceAll('/right.', '<div style="float:right;">');
			texto = texto.replaceAll('.right/', '</div>');
			texto = texto.replaceAll('/link[', '<a href="');
			texto = texto.replaceAll(']link.', '" target="_blank">');
			texto = texto.replaceAll('.link/', '</a>');
			texto = texto.replaceAll('/code.', '<code>');
			texto = texto.replaceAll('.code/', '</code>');
			texto = texto.replaceAll('/li.', '<div style="margin-top:10px"></div><span style="margin-left:2.3em; margin-right:0.5em;">•</span>');
			texto = texto.replaceAll('/break.', '<br>');
			texto = texto.replaceAll('/sbreak.', '<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;');
			texto = texto.replaceAll('/pagebreak.', '<div class="pagebreak"></div>');
			texto = texto.replaceAll('/comm.', '<!--');
			texto = texto.replaceAll('.comm/', '-->');
			texto = texto.replaceAll('/doctitle.', '<title>');
			texto = texto.replaceAll('.doctitle/', '</title>');
			texto = texto.replaceAll('/codeblock.', '<pre><code class="codeSection">');
			texto = texto.replaceAll('.codeblock/', '</code class="codeSection"></pre>');
			texto = texto.replaceAll('/imagefooter.', '<div class="imageFooter">');
			texto = texto.replaceAll('.imagefooter/', '</div>');
			texto = texto.replaceAll('/image.', '<img src="../images/');
			texto = texto.replaceAll('.image/', '" class="imagen"/>');
			texto = texto.replaceAll('/imagemid.', '<img src="../images/');
			texto = texto.replaceAll('.imagemid/', '" class="imagen2"/>');
			texto = texto.replaceAll('/imagetiny.', '<img src="../images/');
			texto = texto.replaceAll('.imagetiny/', '" class="imagen3"/>');
			texto = texto.replaceAll('/center.', '<center>');
			texto = texto.replaceAll('.center/', '</center>');
			texto = texto.replaceAll('/inlineimage.', '<img src="../images/');
			texto = texto.replaceAll('.inlineimage/', '" class="imagen4"/>');
			texto = texto.replaceAll('/parallelarea.', '<table><tr>');
			texto = texto.replaceAll('.parallelarea/', '</tr></table>');
			texto = texto.replaceAll('/parallel.', '<td>');
			texto = texto.replaceAll('.parallel/', '</td>');

			//Esto siempre va al final
			texto = texto.replaceAll('/[.', '[');
			texto = texto.replaceAll('/].', ']');
			texto = texto.replaceAll("&barrita;", '/');

			//Reemplazo html
			document.body.innerHTML = texto;

			//Cosas post HTML
            var matches = document.querySelectorAll("code");
            for(var index in matches) {
				try{
					console.log(matches[index]);
					if(matches[index].className == "codeSection"){
						var lineas = matches[index].innerHTML.split("\n");
						matches[index].innerHTML = "";
						var counter = 1;
						for(a = 0; a < lineas.length; a++){
							if(lineas[a].trim().length == 0) continue;
							matches[index].innerHTML += (counter>1?"<br>":"") + (counter) + "\t"+ lineas[a];
							counter++;
						}
						console.log(matches[index].innerHTML);
					}
				}catch(e){

				}
            }
		}
	</script>
	</body>
</html>




















